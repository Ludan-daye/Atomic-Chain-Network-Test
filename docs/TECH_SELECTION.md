# NetCrate 技术选型与合规基线

## 1. 技术架构决策

### 编程语言：Go (>=1.21)

**选择理由：**
- **静态编译**：生成单一可执行文件，无需运行时依赖
- **跨平台支持**：简化 Linux/macOS/Windows 分发
- **网络编程生态**：原生支持 raw socket、丰富的网络库
- **并发模型**：Goroutine 适合高并发网络操作
- **性能表现**：接近 C/Rust，远超脚本语言
- **学习曲线**：相对平缓，便于社区贡献

### 目标平台

**首发平台：** macOS  
**支持架构：** arm64, amd64, Universal Binary 2

**分发策略：**
- 独立二进制文件（最高优先级）
- Homebrew Tap（推荐安装方式）
- .pkg 安装包（GUI 用户友好）

## 2. 合规与安全基线

### 网络范围限制

**默认允许范围（私网）：**
```
10.0.0.0/8          # RFC 1918 - Class A私网
172.16.0.0/12       # RFC 1918 - Class B私网  
192.168.0.0/16      # RFC 1918 - Class C私网
127.0.0.0/8         # IPv4 回环
::1/128             # IPv6 回环
```

**公网访问策略：**
- 默认禁止公网目标
- 需要 `--dangerous` 标志 + 交互式二次确认
- 未授权时直接拒绝执行

### 速率与并发限制

| 配置档位 | 最大速率(pps) | 最大并发 | 使用场景 | 需要确认 |
|---------|--------------|----------|----------|----------|
| Safe    | 100          | 200      | 默认模式 | 否       |
| Fast    | 400          | 800      | 高速扫描 | 是       |
| Custom  | 用户定义      | 用户定义  | 专家模式 | 是       |

### 权限处理策略

**无特权运行：**
- 自动回退到 TCP connect 扫描
- 使用系统 ping 命令进行 ICMP 探测
- 提示用户使用 `sudo` 获得 raw socket 权限

**特权操作：**
- Raw socket 创建（需要 root/CAP_NET_RAW）
- 自定义数据包构造
- 低级网络接口操作

### 操作限制

**默认禁用的危险操作：**
- DoS/洪泛攻击模式
- 畸形数据包生成
- 高频率扫描（>400pps）
- ARP 投毒/欺骗

## 3. 用户体验设计

### 交互模式

1. **Quick 模式**：新手友好的向导式交互
   - 自动网卡识别 → CIDR 推导 → 探活 → 端口扫描 → 包发送
   - 一条命令完成完整流程

2. **Ops 模式**：专业用户的原子操作
   - `discover`, `scan ports`, `packet send` 等独立命令
   - 支持管道和脚本化

3. **Template 模式**：可复用的任务模板
   - YAML 格式定义复杂工作流
   - 支持参数化和交互式补全

### 输出格式

- **人类可读**：表格、进度条、彩色输出
- **机器可读**：JSON/NDJSON 格式
- **审计友好**：完整的操作日志和结果导出

## 4. 版本策略

**版本命名：** 语义化版本（SemVer）
- **0.x.x**：MVP 开发阶段，API 可能变更
- **1.0.0**：稳定版本，向后兼容承诺
- **x.y.z**：补丁版本仅修复 bug

**模板兼容性：**
- 模板声明支持的最小引擎版本
- 引擎向前兼容旧版本模板
- 破坏性变更通过主版本号体现

## 5. 依赖管理

**核心依赖：**
- 网络操作：`golang.org/x/net`
- CLI 框架：`github.com/spf13/cobra`
- 配置管理：`github.com/spf13/viper`
- 终端交互：`github.com/charmbracelet/bubbletea`

**构建工具：**
- Go Modules 管理依赖
- GoReleaser 自动化发布
- GitHub Actions CI/CD

---

**文档版本：** v1.0  
**最后更新：** 2025-08-28  
**负责人：** 项目维护团队